<!DOCTYPE html>
<html lang="pt-BR" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="description" content="">
    <meta name="keywords" content="formata√ß√£o, windows, linux, freebsd, bios, uefi, instala√ß√£o, balena, etcher, ventoy, os">
    <meta name="author" content="Cain">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sway</title>
    <!--Social Media Open Graph-->
    <meta property="og:title" content="Wayland e PipeWire no Arch Linux com o Sway"/>
    <meta property="og:url" content="https://cain-dev.github.io/default/"/>
    <meta property="og:type" content="article"/>
    <meta property="og:description" content="Saia do paradigma de √°rea de trabalho √∫nica e ter que ficar movendo janelas"/>
    <meta property="og:image" content="https://raw.githubusercontent.com/cain-dev/default/main/assets/images/ogimage.jpg"/>
    <!--/Social Media Open Graph-->
    <!--Links-->
    <link rel="shortcut icon" href="https://avatars1.githubusercontent.com/u/32400794?s=32">
    <link rel="stylesheet" type="text/css"href="../os_style.css">   
    <!--/Links-->
</head>
<body>
    <header id="main-header">
        <ul>
            <li><a href="../index.html">Home</a></li>
            <li><p>@cain-dev</p></li>
            <li><a href="../extra/contact.html">Contato</a></li>
        </ul>
    </header>
    <main id="main-area">
        <h1>Instala√ß√£o do Sway e Pipewire no Arch</h1>
        <img class="responsiva" src="https://swaywm.org/logo.png" alt="">
        <h2>Introdu√ß√£o</h2>
        <p>Sway √© um compositor de Wayland e um substituto drop-in para o gerenciador de janelas i3 para X11. Ele funciona com sua configura√ß√£o i3 existente e oferece suporte √† maioria dos recursos do i3, al√©m de alguns extras (como gaps).<br>O Sway permite que voc√™ organize as janelas do aplicativo de forma l√≥gica, em vez de espacialmente. As janelas s√£o organizadas em uma grade por padr√£o, o que maximiza a efici√™ncia da tela e pode ser rapidamente manipulado usando apenas o teclado. </p>
        <h2>Instala√ß√£o</h2>
	<h3>0 - Prepara√ß√£o para login</h3>
	<p>Para que o Sway seja iniciado, √© necess√°rio acesso aos seus dispositivos como teclado, mouse e placa de v√≠deo, para permitir isso existem 2 maneiras (<strong>escolha apenas 1 das op√ß√µes!</strong>):</p>
	<p>A primeira e a mais direta √© adicionar o usu√°rio ao grupo <mark>seatd</mark> com o comando:</p>
	<code>sudo usermod -aG seatd "seunomedeusu√°rio"</code>
	<p>E habilitar o SeatD com o comando:</p>
	<code>systemctl enable seatd.service</code>
	<p>A segunda e mais comum √© instala√ß√£o do pacote <mark>polkit</mark> e habilita√ß√£o do <mark>systemd-logind</mark>:</p>
	<code>pacman -S polkit</code>
	<code>systemctl enable systemd-logind.service</code>
	<h3>1 - Instalar os componentes</h3>
        <p>Para instalar os componentes b√°sicos utilize o comando:</p> 
        <code>pacman -S sway foot waybar wofi xorg-xwayland qt6-wayland glfw-wayland ttf-font-awesome wl-clipboard</code>
        <h3>2 - Copiar o arquivo template do Sway para a pasta de usu√°rio</h3>
        <p>logue no seu usu√°rio (n√£o root) e logo em seguida acesse o diret√≥rio de configura√ß√µes de usu√°rio com o comando:</p>
        <code>cd ~/.config</code>
        <p> SE o diret√≥rio n√£o for encontrado, crie ele executando o comando:</p>
        <code>mkdir .config</code>
        <p>J√° dentro do diret√≥rio <mark>.config</mark>, crie o diret√≥rio do Sway com o comando:</p>
        <code>mkdir sway</code>
        <p>Mude para o diret√≥rio do Sway com o comando:</p>
        <code>cd sway</code>
        <p>Copie o arquivo de template do Sway <mark>/etc/sway/config</mark> para o diret√≥rio atual <mark>.</mark> com o comando:</p>
        <code>cp /etc/sway/config .</code>
        <p>A configura√ß√£o padr√£o de comandos do Sway √©:<br>
        Recarregar Sway: <mark>Super+Shift+c</mark> (n√£o fechar√° ou recarregar√° os programas ou o novo estilo para os programas que estejam rodando)<br>
        Sair do Sway: <mark>Super+Shift+e</mark><br>
        Abrir Terminal: <mark>Super+Enter</mark><br>
        Abrir lan√ßador: <mark>Super+d</mark><br>
        </p>
        <h3>3 - Editando o arquivo de configura√ß√£o do Sway no diret√≥rio do usu√°rio <mark>/home/seuusuario/.config/sway/config</mark></h3>
        <p>Aqui v√£o algumas configura√ß√µes recomendadas para o seu Sway, voc√™ pode editar o arquivo de configura√ß√£o de usu√°rio utilizando o nano:</p>
        <code>nano .config/sway/config</code>
        <h4>//Mudar a modkey</h4>
        <p>Em:</p>
        <code># Logo key. Use Mod1 for Alt.<br>set $mod Mod4</code>
        <p>Mude para:</p>
        <code>set $mod Mod1</code>
        <h4>//Adicionar o Wofi</h4>
        <p>Em:</p>
        <code>
            # Your preferred application launcher<br>
            # Note: pass the final command to swaymsg so that the resulting window can be opened<br>
            # on the original workspace that the command was run on.<br>
            set $menu dmenu_path | dmenu | xargs swaymsg exec --
        </code>
        <p>Mude para:</p>
        <code>set $menu wofi --show=drun -I</code>
        <h4>//Alterar papel de parede</h4>
        <p>Em:</p>
        <code>### Output configuration<br>
            #<br>
            # Default wallpaper (more resolutions are available in @datadir@/backgrounds/sway/)<br>
            output * bg @datadir@/backgrounds/sway/Sway_Wallpaper_Blue_1920x1080.png fill<br>
        </code>
        <p>Mude a linha <mark>output</mark> para:</p>
        <code>output * bg /diret√≥rio/nomedaimagem.png fill</code>
        <h4>//Mudar bind para fechar janelas</h4>
        <p>Em:</p>
        <code># Kill focused window<br>
            bindsym $mod+Shift+q kill
        </code>
        <p>Mude para:</p>
        <code># Kill focused window<br>
            bindsym $mod+q kill
        </code>
        <h4>//Adicionar Waybar</h4>
        <p>Em:</p>
        <code>bar {<br>
            position top<br>
            <br>
            # When the status_command prints a new line to stdout, swaybar updates.<br>
            # The default just shows the current date and time.<br>
            status_command while date +'%Y-%m-%d %I:%M:%S %p'; do sleep 1; done<br>
            <br>
            colors {<br>
                statusline #ffffff<br>
                background #323232<br>
                inactive_workspace #32323200 #32323200 #5c5c5c<br>
                }<br>
        }
        </code>
        <p>Apague tudo entre as <mark>{}</mark> e mude para:</p>
        <code>
            bar {<br>
                swaybar_command waybar<br>
                }
        </code>
        <h4>//Carregar teclado ABNT2:</h4>
        <p>ap√≥s:</p>
        <code>bar {<br>
            swaybar_command waybar<br>
            }
        </code>
        <p>E antes de:</p>
        <code>include /etc/sway/config.d/*</code>
        <p>Adicione:</p>
        <code>input * {<br>
            xkb_layout "br"<br>
            xkb_variant "abnt2"<br>
            }
        </code>
        <h4>//Habilitar toque e rolagem natural no touchpad</h4>
        <p>Ap√≥s:</p>
        <code>
            input * {<br>
                xkb_layout "br"<br>
                xkb_variant "abnt2"<br>
                }
        </code>
        <p>Adicione:</p>
        <code>input type:touchpad {<br>
            tap enabled<br>
            natural_scroll enabled<br>
            }
        </code>
        <h4>//Habilitar gaps</h4>
        <p>Ap√≥s:</p>
        <code>input type:touchpad {<br>
            tap enabled<br>
            natural_scroll enabled<br>
            }
        </code>
        <p>Insira:</p>
        <code>gaps inner 10</code>
        <h4>//Remover barra de t√≠tulo</h4>
        <p>Ap√≥s:</p>
        <code>gaps inner 10</code>
        <p>Insira:</p>
        <code>default_border pixel 3</code>
        <h4>//Alterar o temo do cursor atrav√©s do xcursor-configuration</h4>
        <p>Adicione as linhas abaixo:</p>
        <code>seat seat0 xcursor_theme <mark>nomedotema</mark> <mark>48</mark></code>
        <p>Substitua o valor <mark>48</mark> pelo tamanho desejado do cursor</p>
        <h4>//Configurar GTK no Sway</h4>
        <p>Adicione as seguintes configura√ß√µes:</p>
        <code>set $gnome-schema org.gnome.desktop.interface<br>exec_always {<br>gsettings set $gnome-schema gtk-theme "<mark>nome do tema GTK</mark>"<br>gsettings set $gnome-schema icon-theme "<mark>nome do tema de √≠cone</mark>"<br>gsettings set $gnome-schema cursor-theme "<mark>nome do tema de cursor</mark>"<br>gsettings set $gnome-schema font-name "<mark>Fonte</mark> <mark>10</mark>"<br>}</code>
        <p>Substitua o <mark>10</mark> pelo tamanho desejado de fonte desejado</p>        
        <h3>4 - Copiar o arquivo template do foot para a pasta de usu√°rio</h3>
        <p>Ainda no seu usu√°rio (n√£o root) acesse o diret√≥rio de configura√ß√µes de usu√°rio com o comando:</p>
        <code>cd ~/.config</code>
        <p>J√° dentro do diret√≥rio <mark>.config</mark>, crie o diret√≥rio do foot com o comando:</p>
        <code>mkdir foot</code>
        <p>Mude para o diret√≥rio do foot com o comando:</p>
        <code>cd foot</code>
        <p>Copie o arquivo de template do foot <mark>/usr/share/foot/foot.ini</mark> para o diret√≥rio atual <mark>.</mark> com o comando:</p>
        <code>cp /usr/share/foot/foot.ini .</code>
        <h3>5 - Editando o arquivo de configura√ß√£o do foot no diret√≥rio do usu√°rio <mark>/home/seuusuario/.config/foot/foot.ini</mark></h3>
        <p>Caso queira utilizar a mesma fonte que eu e n√£o tenha a fonte <mark>Inconsolata</mark> voc√™ pode instal√°-la com comando:</p>
        <code>pacman -S ttf-inconsolata</code>
        <p>E ent√£o descomente e altere a linha de:</p>
        <code># font=monospace:size=8</code>
        <p>Para:</p>
        <code>font=inconsolata:size=12</code>
        <p>Para habilitar a anima√ß√£o do cursor descomente e altere a linha de:</p>
        <code># blink=no</code>
        <p>Para:</p>
        <code>blink=yes</code>
        <p>Para habilitar transpar√™ncia do terminal descomente e altere a linha de:</p>
        <code># alpha=1.0</code>
        <p>Para:</p>
        <code>alpha=0.8</code>
	<h4>Instala√ß√£o do fish (opcional)</h4>
	<p>Para uma experi√™ncia mais intuitiva ao interagir com o terminal voc√™ pode instalar o <mark>fish shell</mark>, para isso utilize o comando:</p>
	<code>pacman -S fish</code>
	<p>E para deixar o fish como padr√£o no foot no lugar do bash basta abrir o arquivo de configura√ß√£o do foot em <mark>/home/seuusuario/.config/foot/foot.ini</mark> e na linha:</p>
	<code># shell=$SHELL (if set, otherwise user's default shell from /etc/passwd</code>
	<p>Descomente a linha e substitua para:</p>
	<code>shell=/bin/fish</code>
        <h3>6 - Copiar os arquivos template do Waybar para a pasta de usu√°rio</h3>
        <p>Ainda no seu usu√°rio (n√£o root) acesse o diret√≥rio de configura√ß√µes de usu√°rio com o comando:</p>
        <code>cd ~/.config</code>
        <p>J√° dentro do diret√≥rio <mark>.config</mark>, crie o diret√≥rio do Waybar com o comando:</p>
        <code>mkdir waybar</code>
        <p>Mude para o diret√≥rio do Waybar com o comando:</p>
        <code>cd waybar</code>
        <p>Copie o arquivo de template do Waybar <mark>/etc/xdg/waybar/config</mark> para o diret√≥rio atual <mark>.</mark> com o comando:</p>
        <code>cp /etc/xdg/waybar/config .</code>
        <p>Copie tamb√©m o arquivo template do estilo do Waybar <mark>/etc/xdg/waybar/style.css</mark> para o diret√≥rio atual <mark>.</mark> com o comando:</p>
        <code>cp /etc/xdg/waybar/style.css .</code>
        <p>Sinta-se a vontade para configurar os arquivos da maneira que quiser.</p>
        <p>Caso tenha d√∫vidas com rela√ß√£o as possibilidades de edi√ß√£o voc√™ pode conferir a documenta√ß√£o:</p>
        <a class="link" href="https://github.com/Alexays/Waybar/wiki/Configuration">documenta√ß√£o da configura√ß√£o do Waybar</a>
        <a class="link" href="https://github.com/Alexays/Waybar/wiki/Styling">documenta√ß√£o da estiliza√ß√£o do Waybar</a>
        <h3>7 - Instalando servidor de √°udio e habilitando compartilhamento de tela</h3>
        <p>Instale o <mark>pipewire</mark> como comando:</p>
        <code>pacman -S pipewire-pulse</code>
        <p>Caso o instalador te pe√ßa para escolher entre <mark>pipewire-media-session</mark> e <mark>WirePlumber</mark>, selecione o <mark>WirePlumber</mark>.</p>
        <p>Para habilitar o compartilhamento de tela no Sway √© necess√°rio a instala√ß√£o do <mark>xdg-desktop-portal-wlr</mark>, para isso utilize o comando:</p>
        <code>pacman -S xdg-desktop-portal-wlr</code>
        <p>Segundo a Archwiki:
        <br>
        <i>O Firefox (84+) suporta este m√©todo por padr√£o, enquanto no Chromium (73+) √© necess√°rio habilitar o suporte WebRTC PipeWire definindo o sinalizador (experimental) na seguinte URL: <code>chrome://flags/#enable-webrtc-pipewire-capturer</code>. O obs-studio (27+) suporta este m√©todo usando a nova fonte de captura PipeWire.</i></p>
        <h3>8 - Instalando o ly Display Manager com o yay</h3>
        <p>Para facilitar a instala√ß√£o e manuten√ß√£o do ly podemos utilizar o yay. Ainda na sua conta de usu√°rio, instale as depend√™ncias necess√°rias com o comando:</p>
        <code>sudo pacman -S git base-devel</code>
        <p>Clone o diret√≥rio do github com o comando:</p>
        <code>git clone https://aur.archlinux.org/yay.git</code>
        <p>Acesse o diret√≥rio do yay com o comando:</p>
        <code>cd yay</code>
        <p>Crie o pacote e instale o yay com o comando:</p>
        <code>makepkg -si</code>
        <p>Instale o ly com o comando:</p>
        <code>yay -S ly</code>
        <p>Por fim, habilite o ly com o comando:</p>
        <code>sudo systemctl enable ly.service</code>
        <p>Caso queira configurar o ly voc√™ pode editar o arquivo de configura√ß√£o que est√° em <mark>/etc/ly/config.ini</mark> com o nano.</p>
        <h3>9 - Otimizando os navegadores para o Sway</h3>
        <h4>//Otimizando o Firefox</h4>
        <p>Para setar as vari√°veis de sistema globalmente edite o arquivo <mark>/etc/environment</mark> com o nano e insira as seguintes linhas:</p>
        <code>MOZ_ENABLE_WAYLAND=1</code> <p>(para habilitar o Wayland no Firefox)</p>
        <code>MOZ_USE_XINPUT2=1</code> <p>(para habilitar comandos de tela touchscreen caso voc√™ possua uma)</p>
        <code>MOZ_WEBRENDER=1</code> <p>(para habilitar o WebRender compositor)</p>
        <p>Ap√≥s isso salve o arquivo, reinicie a m√°quina e verifique as vari√°veis de ambiente com o comando <code>printenv</code>.</p>
        <p>Assim que reiniciar abra o Firefox e sete o:<code>gfx.webrender.compositor.force-enabled</code> para <code>true</code> em <code>about:config</code>. Ap√≥s isso reinicie o Firefox.</p>
        <p>Para verificar se funcionou, procure por <code>Window Protocol</code> em  <code>about:support</code>. Se voc√™ fez certo dever√° ser <code>wayland</code>.</p>        
        <p>No Wayland nativo, o desempenho de renderiza√ß√£o do Firefox pode ser significativamente melhorado por essa configura√ß√£o, toda a renderiza√ß√£o pode ocorrer em superf√≠cies de composi√ß√£o nativas, resultando em uma renderiza√ß√£o mais eficiente, melhorando o desempenho e a vida √∫til da bateria (caso voc√™ utilize um laptop).</p>
        <h4>//Otimizando o Chromium (e derivados)</h4>
        <p>Em <mark>/home/meuusuario/.config/chromium-flags.conf</mark> adicione as linhas:</p>
        <code>--enable-features=UseOzonePlatform<br>
            --ozone-platform=wayland
        </code>
        <p>Caso voc√™ queira habilitar acerela√ß√£o por hardware voc√™ pode tamb√©m adicionar a linha:</p>
        <code> --enable-gpu</code>
        <p>Salve o arquivo e reinicie o Chromium para que as mudan√ßas tenham efeito.</p>
        <h3>10 - Adicionando suporte b√°sico para notifica√ß√µes</h3>
        <p>Para possiblitar a exibi√ß√£o de notifica√ß√µes simples utilizaremos o <mark>Mako</mark>, utilize o comando abaixo para a instala√ß√£o:</p>
        <code>pacman -S mako</code>
        <p>E agora precisamos adicionar a execu√ß√£o do <mark>Mako</mark> junto ao arquivo de configura√ß√£o do Sway, em <mark>.config/sway/config</mark> adicione:</p>
        <code>exec mako</code>
        <p>Para testar as notifica√ß√µes voc√™ pode utilizar o <a class="link" href="https://www.bennish.net/web-notifications.html">HTML5 Web Notifications Test</a>.</p>
	<p>Se as notifica√ß√µes funcionaram, voc√™ pode configurar o mako alterando o arquivo em <mark>~/.config/mako/config</mark> e seguindo a p√°gina de manual do mako nesse link <a class="link" href="http://manpages.ubuntu.com/manpages/impish/man5/mako.5.html">aqui</a>.</p>
	<h3>11 - Captura de tela com o Flameshot</h3>
	<p><mark>Flameshot</mark> √© um daqueles programas que melhora muito sua produtividade quando voc√™ precisa fazer alguma captura de tela, infelizmente apenas instalar o pacote com o pacman n√£o √© o suficiente, por√©m assim que devidamente configurado ele funciona perfeitamente. Para utilizar o Flameshot primeiro temos que instalar os pacotes abaixo:</p>
	<code>
		sudo pacman -S flameshot xdg-desktop-portal xdg-desktop-portal-wlr grim
	</code>
	<p>Uma vez que os pacotes est√£o instalados √© necess√°rio declarar algumas vari√°veis de ambiente, √© interessante que sejam declaradas antes da inicializa√ß√£o do Sway (embora n√£o seja a melhor op√ß√£o voc√™ pode adicionar ao <mark>/etc/environment</mark> para isso). Declare as vari√°veis de ambiente abaixo:</p>
	<code>
		SDL_VIDEODRIVER=wayland<br>
		_JAVA_AWT_WM_NONREPARENTING=1<br>
		QT_QPA_PLATFORM=wayland<br>
		XDG_CURRENT_DESKTOP=sway<br>
		XDG_SESSION_DESKTOP=sway<br>
	</code>
	<p>Uma vez que as vari√°veis estejam declaradas basta adicionar as linhas abaixo no arquivo de configura√ß√£o do <mark>Sway</mark>:</p>
	<pre><code>
exec systemctl --user import-environment DISPLAY WAYLAND_DISPLAY SWAYSOCK
exec hash dbus-update-activation-environment 2>/dev/null && \
	dbus-update-activation-environment --systemd DISPLAY WAYLAND_DISPLAY SWAYSOCK
	</code></pre>
	<p>Pronto! Uma vez que o Sway seja <mark>reiniciado</mark> o comando <mark>flameshot gui</mark> vai iniciar uma captura de tela... Mas n√≥s podemos adicionar um atalho Sway para que a tecla print j√° inicie o Flameshot, para isso adicione a linha abaixo no arquivo de configura√ß√£o do Sway:</p>
	<code>
	bindsym Print exec flameshot gui
	</code>
	<p><strong>Importante:</strong> Lembre-se que para habilitar a √°rea de transfer√™ncia voc√™ precisa ter instalado o <mark>wl-clipboard</mark>.</p>
	<h3>12 - Gerenciamento de m√≠dias remov√≠veis com o Udiskie</h3> 
	<img class="responsiva" src="https://raw.githubusercontent.com/coldfix/udiskie/master/screenshot.png" alt="">
	<p>O udiskie √© uma excelente ferramenta para gerenciar m√≠dias remov√≠veis de forma gr√°fica e simples, casa muito bem com a a bandeija da Waybar. Para instalar o udiskie utilize o comando:</p>
	<code>sudo pacman -S udiskie</code>
	<p>Uma vez que o udiskie foi instalado voc√™ deve adicionar as seguintes linhas no arquivo de configura√ß√£o do Sway para mostrar o √≠cone na bandeija:</p>
<pre><code>
exec_always {
	udiskie --appindicator -t
	}
</code></pre>
	<p><strong>Importante:</strong> N√£o esque√ßa de declarar a configura√ß√£o e adicionar o m√≥dulo de tray na sua Waybar! N√£o tem como exibir um √≠cone de bandeija sem bandeija declarada (obviamente).</p>
	<p>Exemplo:
	<pre><code>
"modules-right": ["tray", "network"...

"tray": {
    "icon-size": 21,
    "spacing": 10
}
	</code></pre>
	<a class="link" href="https://www.bennish.net/web-notifications.html">Documenta√ß√£o do m√≥dulo de tray</a>
	<p><mark>Resolu√ß√£o de problemas:</mark></p>
	<p>O udiskie requer permiss√£o para algumas a√ß√µes do polkit que geralmente s√£o concedidas ao usar um ambiente de desktop. Se sua sess√£o de login n√£o estiver ativada corretamente, talvez seja necess√°rio personalizar suas configura√ß√µes de polkit. Crie o arquivo <mark>/etc/polkit-1/rules.d/50-udiskie.rules</mark> com permiss√µes <mark>644</mark> e com o seguinte conte√∫do:</p>
<pre><code>
polkit.addRule(function(action, subject) {
  var YES = polkit.Result.YES;
  var permission = {
    // required for udisks1:
    "org.freedesktop.udisks.filesystem-mount": YES,
    "org.freedesktop.udisks.luks-unlock": YES,
    "org.freedesktop.udisks.drive-eject": YES,
    "org.freedesktop.udisks.drive-detach": YES,
    // required for udisks2:
    "org.freedesktop.udisks2.filesystem-mount": YES,
    "org.freedesktop.udisks2.encrypted-unlock": YES,
    "org.freedesktop.udisks2.eject-media": YES,
    "org.freedesktop.udisks2.power-off-drive": YES,
    // required for udisks2 if using udiskie from another seat (e.g. systemd):
    "org.freedesktop.udisks2.filesystem-mount-other-seat": YES,
    "org.freedesktop.udisks2.filesystem-unmount-others": YES,
    "org.freedesktop.udisks2.encrypted-unlock-other-seat": YES,
    "org.freedesktop.udisks2.eject-media-other-seat": YES,
    "org.freedesktop.udisks2.power-off-drive-other-seat": YES
  };
  if (subject.isInGroup("storage")) {
    return permission[action.id];
  }
});
</code></pre>
	<p>Essa configura√ß√£o permite que todos os membros do grupo de <mark>storage</mark> executem o udiskie.<br>Para adicionar o seu usu√°rio no grupo storage basta utilizar o comando:</p>
	<code>usermod -a -G storage <mark>seuusername</mark></code>
    </main>
    <footer id="main-footer">
        <p>Est√° p√°gina ainda est√° em constru√ß√£o üöß</p>
        <a class="footerlink" href="#main-header">‚Üë Retornar ao topo ‚Üë</a>
    </footer>
</body>
</html>
