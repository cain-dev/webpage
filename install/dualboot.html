<!DOCTYPE html>
<html lang="pt-BR" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="description" content="">
    <meta name="keywords" content="formata√ß√£o, windows, linux, freebsd, bios, uefi, instala√ß√£o, balena, etcher, ventoy, os">
    <meta name="author" content="Cain">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dual Boot</title>
    <!--Social Media Open Graph-->
    <meta property="og:title" content="Instala√ß√£o Avan√ßada de Sistemas Operacionais - Dual Boot"/>
    <meta property="og:url" content="https://cain-dev.github.io/default/"/>
    <meta property="og:type" content="article"/>
    <meta property="og:description" content="Dual boot √© uma das coisas mais incompreendidas quando o assunto √© instala√ß√£o de sistemas operacionais e o que infelizmente n√£o falta √© desinforma√ß√£o a respeito, aprenda como se faz"/>
    <meta property="og:image" content="https://raw.githubusercontent.com/cain-dev/default/main/assets/images/ogimage.jpg"/>
    <!--/Social Media Open Graph-->
    <!--Links-->
    <link rel="shortcut icon" href="assets/images/cainlogo.ico">
    <link rel="stylesheet" type="text/css"href="../os_style.css">   
    <!--/Links-->
</head>
<body>
    <header id="main-header">
        <ul>
            <li><a href="../index.html">Home</a></li>
            <li><p>@cain-dev</p></li>
            <li><a href="../extra/contact.html">Contato</a></li>
        </ul>
    </header>
    <main id="main-area">
        <h1>Instala√ß√£o Avan√ßada de Sistemas - Fazendo Dual Boot</h1>
        <h2>Introdu√ß√£o</h2>
        <p>A primeira coisa que voc√™ deve ter notado aqui √© que eu fiz quest√£o de categorizar a instala√ß√£o de dual boot como uma instala√ß√£o <strong>avan√ßada</strong>. Dual boot √© uma das coisas mais incompreendidas quando o assunto √© instala√ß√£o de sistemas operacionais e o que infelizmente n√£o falta √© desinforma√ß√£o a respeito. Infelizmente o dual boot √© vendido como uma coisa f√°cil de se fazer que vai ser como a segunda vinda de Cristo na terra para solucionar todos os seus problemas, mas acontece que a verdade √© outra pois <em>tutorial de dual boot √© como um comercial de Ferrari na Sess√£o da Tarde: Quem tiraria proveito de ver aquilo provavelmente n√£o vai ver.</em></p>
        <p>Em quase todos os tutoriais que existem por a√≠ sempre √© dito <strong>como</strong> fazer o dual boot mas jamais se cai na discuss√£o de <strong>se</strong> deve ser feito e <strong>quando</strong> deve ser feito. A √∫nica coisa que √© dita do dual boot √© que voc√™ vai poder utilizar tanto o Windows quanto o Linux (ou algum BSD) na mesma m√°quina para que voc√™ possa (em tese) aproveitar os dois sistemas quando quiser... <em>Mas lembre-se: S√£o 2 sistemas para dar problema! S√£o 2 pontos de inicializa√ß√£o que voc√™ deve gerenciar! S√£o 2 vezes mais superf√≠cie de ataque e s√£o (no m√≠nimo) 2 vezes o conhecimento necess√°rio para lidar do que com um sistema s√≥.</em> E para explicar a analogia que eu fiz acima, a pessoa que pode e deveria usar um dual boot sem problemas √© justamente a pessoa que n√£o precisa de um tutorial de como fazer um dual boot, assim como a pessoa que precisa de um tutorial de dual boot √© justamente a pessoa que <strong>n√£o deveria usar dual boot.</strong></p>
        <p>Pra quem <em>realmente</em> serve o dual boot? Serve para a pessoa que tem maestria em 2 sistemas e tem condi√ß√£o de operar 2 sistemas em uma mesma m√°quina, √© o cara que configura o Windows sem problemas e o Linux (ou algum BSD) tamb√©m sem problema algum. √â para aquele indiv√≠duo que seja l√° quais sejam os 2 sistemas colocados ele vai dar conta de operar ambos no seu m√°ximo e n√£o pela metade. <em>Se voc√™ usa dois sistemas √© 2 vezes a m√£o de obra e n√£o a metade.</em> Dual boot especialmente em notebooks ou <strong>em m√°quinas de somente 1 dispositivo de armazenamento √© extremamente problem√°tico</strong> especialmente por precisar de configura√ß√µes espec√≠ficas que voc√™ tem que fazer para que ambos os sistemas funcionem em harmonia sem atrapalharem um ao outro, e isso sem contar que alguns sistemas simplesmente n√£o foram feitos para iniciar "ao lado de outro", o Windows por exemplo tende a "sequestrar" a inicializa√ß√£o do seu computador e "travar" a parti√ß√£o que ele tem acesso.</p>
        <p>Via de regra, <em>se voc√™ n√£o tem extenso conhecimento de particionamento, de bootloaders, de como configurar completamente a bios... Dual boot n√£o √© pra voc√™.</em> Muita gente diz que o dual boot √© bom para iniciantes mas o que geralmente acontece √© que os novatos que come√ßam no dual boot tratam ele como uma muleta e tem metade das suas atividades em cada inicializa√ß√£o do computador. Se voc√™ quer aprender o Linux ou algum BSD, ou qualquer outro sistema, <em>voc√™ n√£o pode fazer isso na situa√ß√£o de quem depende do Windows</em> (por exemplo). Migrar √© um termo absoluto, √© como gravidez ou honestidade, n√£o existe gente meio gr√°vida ou meio honesto e tamb√©m n√£o existe como fazer meia migra√ß√£o. Querer migrar para Linux ou qualquer outro sistema querendo a seguran√ßa de poder voltar para o Windows seria como assinar um casamento no civil j√° abertamente namorando outra guria pois "vai que n√£o da certo, n√©?".</p>
        <p>O dual boot serve pro indiv√≠duo que est√° desenvolvendo algo e precisa fazer testes em 2 sistemas e/ou tem dom√≠nio de ambos, √© para aquele que tem os 2 sistemas na m√°quina mas poderia perfeitamente se virar com 1 s√≥. √â para o cara que j√° utiliza ferramentas agn√≥sticas (ou seja, que n√£o dependem de um sistema espec√≠fico) ou que tem um uso isolado de um dos sistemas (por exemplo ter uma parti√ß√£o do Windows √∫nica e exclusivamente para jogar).</p>
        <p>Se voc√™ √© do tipo de pessoa que pensa algo como <em>"quero usar o Linux mas preciso do Word para editar meus textos"</em> considere-se oficialmente chutado dessa p√°gina. Eu vou utilizar termos t√©cnicos aqui sem a menor pretens√£o de explicar e se voc√™ resolver seguir sem o devido conhecimento pode ter a certeza de que as coisas v√£o dar errado pra voc√™, esteje avisado.</p>
        <h2>Instala√ß√£o Windows + Linux</h2>
        <h3>Como particionar o disco?</h3>
        <p>A longevidade e viabilidade de um sistema dual boot j√°s na maneira em que o disco √© preparado, ainda na pr√©-instala√ß√£o. Voc√™ pode simplesmente usar a fun√ß√£o de "instalar o Linux ao lado do Windows" ou simplesmente deixar uma parti√ß√£o para o Windows (para que ele ferre com voc√™ e ocupe toda e qualquer outra parti√ß√£o livre nos seus discos da maneira que ele desejar). O interessante seria que voc√™ (primeiramente fizesse backup utilizando uma unidade de armazenamento externa e que se desconectasse do computador, obviamente) desconetasse toda e qualquer unidade de armazenamento que n√£o vai receber um sistema. Voc√™ pode fazer a instala√ß√£o com mais de uma unidade conectada a m√°quina, mas lembre-se que as chances s√£o que voc√™ vai ter problemas.</p>
        <p>Existe uma diferen√ßa consider√°vel entre fazer um dual boot em BIOS e UEFI, em UEFI basta que os inicializadores dos sistemas estejam na parti√ß√£o ESP e que o inicializador correto seja selecionado, em modo BIOS √© necess√°rio que a sua MBR esteja configurada redirecionando para um boot menu e nesses casos o Windows tende a destruir a configura√ß√£o de dual boot na MBR. Ent√£o de cara √© bom voc√™ saber: Se voc√™ utiliza BIOS e quer fazer dual boot com Windows, vez ou outra vai ter que usar algum Boot Repair Disk ou algo assim, portanto eu n√£o recomendo j√° que dualboot em BIOS √© certeza de dor de cabe√ßa.</p>
        <h3>Em BIOS</h3>
        <p>Se ainda assim voc√™ quer se arriscar, a instala√ß√£o √© extremamente simples e se resume em reservar uma parte n√£o utilizada do disco para o segundo sistema durante a instala√ß√£o do Windows, e durante a instala√ß√£o do segundo sistema configurar um boot menu na MBR (quase sempre apenas um <mark>sudo update-grub</mark> resolve) ou no caso do Linux utilizar a op√ß√£o de instalar "ao lado do Windows". R√°pido? Sim, mas garante pouco controle do espa√ßo em disco.</p>
        <h3>Em UEFI</h3>
        <p>Para Windows + Linux em UEFI eu recomendo a utiliza√ß√£o de algum sistema live e gr√°fico para fazer a tabela de parti√ß√£o (eu geralmente utilizo o Linux Mint), inicie o <mark>GParted</mark>, no lado superior direito da tela selecione o disco em que voc√™ quer fazer o dual boot, na guia <mark>Dispositivo</mark> selecione <mark>Criar tabela de parti√ß√µes</mark>, e no tipo de tabela de parti√ß√µes selecione <mark>gpt</mark> e depois <mark>aplicar</mark>.</p>
        <p>Clique com o bot√£o direito em <mark>n√£o alocado</mark> e selecione <mark>novo</mark> para criar uma parti√ß√£o, crie no inicio do disco uma parti√ß√£o, em <mark>Tamanho (MiB):</mark> escreva <mark>512</mark>, em <mark>Sistema de arquivos:</mark> selecione <mark>fat32</mark> e em <mark>Nome da parti√ß√£o:</mark> escreva <mark>esp</mark>, aplique as altera√ß√µes selecionando a guia <mark>Editar</mark> e depois <mark>Aplicar todas as opera√ß√µes</mark>. Ap√≥s isso clique com o bot√£o direito na parti√ß√£o esp, e selecione <mark>gerenciar sinalizadores</mark> e marque <mark>esp</mark>, <mark>boot</mark> tamb√©m ser√° selecionado automaticamente.</p>
        <p>Pronto! Voc√™ tem uma parti√ßao ESP num disco em GPT e agora basta criar uma parti√ß√£o EXT4 para o Linux, lembre-se de selecionar a parti√ß√£o esp durante a instala√ß√£o do Linux (sem selecionar a op√ß√£o <mark>formatar a parti√ß√£o</mark>) e selecionar a raiz (<mark>/</mark>) na parti√ß√£o ext4. N√£o crie a parti√ß√£o do Windows pelo GParted pois o Windows cria mais 2 ou 3 parti√ß√µes e se ele s√≥ tiver a NTFS que voc√™ criou ele vai criar o resto das pati√ß√µes em outras unidades de armazenamento, apenas deixe o espa√ßo livre e crie as parti√ß√µes do Windows utilizando esse espa√ßo livre durante a instala√ß√£o do Windows.</p>
        <p>Recapitulando:</p>
        <ol>
            <li>Criar parti√ß√£o EFI no inicio do disco, 512MiB de tamanho, formato fat32, sinalizada como boot/esp.</li>
            <li>Criar parti√ß√£o do segundo sistema reservado em ext4 (ou qualquer outro formato que o Windows n√£o reconhe√ßa para ele n√£o destruir).</li>
            <li>Deixar um espa√ßo livre para que o Windows configure as suas parti√ß√µes da maneira que preferir.</li>
        </ol>
        <img class="responsiva" src="../assets/images/install/dualboot/dualboot1.jpg" alt=""><br>
        <p>Durante a instala√ß√£o do segundo sistema selecione a parti√ß√£o EFI, <mark>Usar como: Parti√ß√£o de sistema EFI</marK> (ou seja l√° como o seu sistema designe essa fun√ß√£o no instalador), <strong>lembre-se de n√£o marcar para formatar essa parti√ß√£o!</strong> </p>
        <img class="responsiva" src="../assets/images/install/dualboot/dualboot2.jpg" alt=""><br>
        <p>Na instala√ß√£o do segundo sistema selecione a segunda parti√ß√£o reservada do disco como parti√ß√£o raiz:</p>
        <img class="responsiva" src="../assets/images/install/dualboot/dualboot3.jpg" alt=""><br>
        <p>Instale o Windows normalmente no espa√ßo vazio (e permita que ele crie as parti√ß√µes de sistema que ele pede):</p>
        <img class="responsiva" src="../assets/images/install/dualboot/dualboot4.jpg" alt=""><br>
        <img class="responsiva" src="../assets/images/install/dualboot/dualboot5.jpg" alt=""><br>
        <h3>Adicionando boot menu e corrigindo a hora e acesso a unidade do Windows em UEFI</h3>
        <p>Para n√£o ter que ficar entrando no menu da bios e selecionando o inicializador cada vez que liga o computador voc√™ pode utilizar o inicializador do grub para chamar o Windows tamb√©m, para isso basta selecionar o inicializador do segundo sistema na bios e atualizar as configura√ß√µes do grub com <mark>sudo update-grub</mark>. O Windows ser√° adicionado no boot menu para voc√™ selecion√°-lo caso deseje.</p>
        <p>Recapitulando: Entre na bios e selecione o inicializador do segundo sistema como o boot padr√£o:</p>
        <img class="responsiva" src="../assets/images/install/dualboot/dualboot6.jpg" alt=""><br>
        <p>Ao entrar no segundo sistema atualize o grub:</p>
        <img class="responsiva" src="../assets/images/install/dualboot/dualboot7.jpg" alt=""><br>
        <p>Ao iniciar o computador voc√™ poder√° escolher qual sistema quer iniciar pelo grub:</p>
        <img class="responsiva" src="../assets/images/install/dualboot/dualboot8.jpg" alt=""><br>
        <p>Ao iniciar um dos sistemas voc√™ pode perceber que a hora fica incorreta, para resolver isso inicie o Windows, baixe esse arquivo <a class="link" href="https://www.howtogeek.com/wp-content/uploads/2017/08/Make-Windows-Use-UTC-Time.zip">Aqui</a>, extraia e utilize o <mark>Make Windows Use UTC Time</mark> para fazer com que o Windows use UTC. Al√©m disso recomendo abrir um terminal como administrador e utilizar o comando <mark>powercfg.exe /hibernate off</mark> para que o Windows n√£o "trave" o estado da parti√ß√£o ao desligar, lembre-se tamb√©m de desligar o <mark>Fast Boot</mark> na sua bios para diminuir as chances do Windows "sequestrar" o boot... Isso ajuda mas <strong>n√£o resolve</strong> 100% dos problemas.</p>
        <h3>O maldito "Sequestro de Boot" e como (tentar) resolv√™-lo</h3>
        <p>Ent√£o voc√™ acabou de instalar o seu sistema, selecionou no <i>Setup</i> da placa m√£e para inicializar o Linux e... O Windows carrega. üôÑ</p>
        <p>Ok, voc√™ desliga o computador segurando <i>Shift</i>, liga direto para o <i>Setup</i>, deixa apenas o Linux como op√ß√£o de inicializa√ß√£o e... O Windows que sobe novamente. üò°</p>
        <p>Oh c√©us, por qual maldita raz√£o isso acontece? Bom, isso pode acontecer pelos mais diversos motivos, mas um deles √© que caso a instala√ß√£o seja em UEFI (o que deveria seria o correto nos dias de hoje) existe uma esp√©cie de interatividade em ordem de boot que n√£o existia na <i>BIOS</i>, que √© <mark>o sistema conseguir se colocar como prioridade no processo de <i>boot</i></mark>, que por algum motivo o Windows acaba sempre fazendo descaradamente.</p>
        <p>Existem diversas maneiras de tentar intervir aqui, mas a que eu mais recomendo √© atrav√©s do uso da ferramenta <mark>efibootmgr</mark>, que vai estar dispon√≠vel em qualquer m√≠dia de instala√ß√£o de sistemas Linux. O <i>efibootmgr</i> √© um programa que vai lidar diretamente com as op√ß√µes de entradas de <i>boot</i> na sua placa m√£e, ou seja, podendo incluir novamente uma op√ß√£o de inicializa√ß√£o, ou mudando a ordem direto pelo sistema, e at√© mesmo podendo excluir entradas de <i>boot</i> (op√ß√£o bem nuclear essa, mas v√°lida em alguns casos).</p>
        <h4>Entrada direta para o Linux</h4>
        <p>Ent√£o o Windows sumiu com sua entrada de <i>boot</i> do Hackintosh OU do FreeBSD OU do Linux, o que voc√™ pode fazer? Bom, voc√™ pode primeiramente recriar essa entrada direta para a sua placa m√£e utilizando o comando abaixo:</p>
        <code>efibootmgr --create --disk /dev/<mark>storageA</mark> --part <mark>P1</mark> --label "<mark>T√≠tulo da Entrada</mark>" --loader /vmlinuz-linux 'root=<mark>UUID do dispositivo</mark> rw initrd=\initramfs-linux.img'</code>
        <p>Lembre-se de substituir <mark>/vmlinuz-linux</mark> e <mark>\initramfs-linux.img</mark> por <mark>/vmlinuz-linux-lts</mark> e <mark>\initramfs-linux-lts.img</mark> caso voc√™ use o kernel LTS.</p>
        <p>Lembre-se de adicionar resume=<mark>UUID do dispositivo</mark> logo ap√≥s 'root=<mark>UUID do dispositivo</mark> caso voc√™ utilize hiberna√ß√£o para <i>swap</i>.</p>
        <p>Lembre-se de adicionar <em>initrd=\amd-ucode.img</em> OU <em>initrd=\intel-ucode.img</em> antes de <em>initrd=\initramfs-linux.img</em> caso utilize microcode.</p>
        <h4>Entrada para um Bootloader</h4>
        <p>Caso voc√™ queira, por exemplo, fazer uma entrada para um loader diretamente (como √© o caso do Opencore para os Hackintoshes ou do systemd-boot) voc√™ pode utilizar o comando abaixo:</p>
        <p>Para o OpenCore:</p>
        <code>efibootmgr --create --disk /dev/<mark>storageA</mark> --part <mark>P1</mark> --loader /EFI/OC/OpenCore.efi --label "OpenCore"</code>
        <p>Para o systemd-boot:</p>
        <code>efibootmgr --create --disk /dev/<mark>storageA</mark> --part <mark>P1</mark> --loader /EFI/BOOT/BOOTX64.EFI --label "systemd-boot"</code>
        <h3>Verificando a ordem de boot:</h3>
        <p>use o comando abaixo para ver as entradas:</p>
        <code>efibootgmr</code>
        <p>E, caso queira alterar a ordem delas, basta utilizar:</p>
        <code>efibootmgr --bootorder <mark>n√∫mero da entrada prim√°ria</mark>,<mark>n√∫mero da entrada secund√°ria</mark></code>
        <h4><strong>Op√ß√£o Nuclear</strong></h4>
        <p>Ent√£o voc√™ criou uma entrada direta para o sistema, e mesmo assim n√£o resolveu, voc√™ ent√£o criou uma entrada para o bootloader, e mesmo assim n√£o resolveu, voc√™ ent√£o mudou a ordem das entradas de boot e meeeesmo assim n√£o resolveu... E agora?</p>
        <p>Bom, algumas implementa√ß√µes de UEFI s√£o simplesmente ruins mesmo, e a√≠ n√£o interessa o quanto voc√™ tente configurar n√£o vai funcionar, esta n√£o √© uma op√ß√£o recomendada MAS em alguns casos que qualquer entrada s√≥ resulta num loop de tentativas de boot na Repara√ß√£o do Windows o que voc√™ pode tentar √© simplesmente mandar pro espa√ßo a entrada do Windows com o comando abaixo:</p>
        <code>efibootmgr --delete-bootnum --bootnum <mark>n√∫mero da entrada do Windows</mark></code>
        <p>E pronto! Desde que voc√™ tenha a entrada para um bootloader que pode inicializar o Windows pra voc√™, voc√™ n√£o ter√° mais problemas de sequestro de boot (pelo menos at√© a pr√≥xima atualiza√ß√£o de sistema) e vai poder selecionar o seu Windows sem problemas.</p>
        <h3>E o que ningu√©m te fala sobre dual boot Windows + Linux?</h3>
        <p>Eu vou tentar resumir: <strong>Se voc√™ escolher fazer um dual boot com Windows, eu n√£o posso de maneira alguma te garantir um m√≠nimo de estabilidade do sistema.</strong> Do ponto de vista de um leigo que a profundidade de conhecimento de sistema √© t√£o profundo quanto √°gua de privada, a ideia de se ter 2 sistemas numa mesma m√°quina parece incr√≠vel, mas certamente n√£o √© de forma alguma o ambiente mais est√°vel e seguro para se usar. O mito do dual boot nasceu de uma certa desvantagem de oferta de software que o Linux sofreu de muito tempo atr√°s, via de regra s√£o pessoas que tem interesse na leveza e responsividade das plataformas Linux mas tem pregui√ßa de achar alternativas de software, e para n√£o ter que (deixar de lado a chupeta) enfrentarem a pesquisa e adapta√ß√£o elas pregui√ßosamente v√™em esse tipo de instala√ß√£o como uma alternativa vi√°vel (claro que sem o devido conhecimento dos custos e dos riscos...).</p>
        <p>O Linux e os BSD's funcionam como um trabalhador bastante humilde e organizado: Eles pegam as ferramentas, eles usam, eles guardam e jamais presumem que s√£o os √∫nicos que podem fazer aquele servi√ßo. O Windows j√° √© um trabalhador folgado e presun√ßoso: Ele pega as ferramentas, ele usa e joga pelo ch√£o e logo em seguida tranca a porta, impedindo que outros usem aquele espa√ßo ou que tenham acesso as mesmas ferramentas.</p>
        <p>4 Exemplos simples que posso destacar aqui √© que em primeiro lugar, o Windows n√£o libera a sua parti√ß√£o depois de usar, ele deixa o sistema da arquivos travado para acelerar o (lento) processo de boot dele, ent√£o dane-se voc√™ se voc√™ tem arquivos importantes que quer acessar al√≠, ele simplesmente trava o acesso. Em segundo lugar, o Windows n√£o s√≥ gerencia a sua parti√ß√£o do sistema mas vive fu√ßando a ordem de boot e o espa√ßo de inicializa√ß√£o do disco, n√£o √© incomum voc√™ atualizar o Windows e ele simplesmente apagar a entrada de inicializa√ß√£o de qualquer outro sistema instalado na m√°quina. Em terceiro lugar, o Windows se comunica com a m√°quina de uma maneira burra e descontrolada, √© comum voc√™ clicar desligar e ele deixar o computador num estado de hiberna√ß√£o, ou seja: Ao desligar o Windows ele N√ÉO vai te permitir acessar o seu Linux, ele n√£o manda o devido "sinal" para a bios de que ele encerrou suas atividades e o pr√≥ximo processo de inicializa√ß√£o pode vir "frio"... Inutilizando o seu dual boot. E em √∫ltimo mas n√£o menos importante √© que o Windows simplesmente n√£o foi arquitetado para tal, at√© mesmo o gerenciador de boot dele n√£o √© sofisticado o suficiente para isso, e por isso o que faz com que o dual boot seja funcional s√£o as ferramentas do Linux ou BSD's e n√£o as do Windows, e a maioria esmagadora dos problemas do dual boot nascem justamente dessa incapacidade do Windows de reconhecer e deixar queto os outros sistemas em disco.</p>
        <p></p>
    </main>
    <footer id="main-footer">
        <p>Est√° p√°gina ainda est√° em constru√ß√£o üöß<br>(Atualizada pela √∫ltima vez em 27/09/2023)</p>
        <a class="link" href="index.html">Retornar para a p√°gina principal</a>
    </footer>
</body>
</html>